

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>StarDist - Object Detection with Star-convex Shapes &mdash; StarDist  documentation</title>
  

  
  
  
  
    <link rel="canonical" href="http://stardist.net/test.html"/>
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> StarDist
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="docs/faq.html">Frequently Asked Questions (FAQ)</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">StarDist</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li><em>StarDist</em> - Object Detection with Star-convex Shapes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/test.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p><a class="reference external" href="https://pypi.org/project/stardist"><img alt="PyPI version" src="https://badge.fury.io/py/stardist.svg" /></a>
<a class="reference external" href="https://travis-ci.com/mpicbg-csbd/stardist"><img alt="Linux build status" src="https://travis-ci.com/mpicbg-csbd/stardist.svg?branch=master" /></a>
<a class="reference external" href="https://ci.appveyor.com/project/UweSchmidt/stardist/branch/master"><img alt="Windows build status" src="https://ci.appveyor.com/api/projects/status/gyu127aqc8y5av79/branch/master?svg=true" /></a></p>
<div class="section" id="stardist-object-detection-with-star-convex-shapes">
<h1><em>StarDist</em> - Object Detection with Star-convex Shapes<a class="headerlink" href="#stardist-object-detection-with-star-convex-shapes" title="Permalink to this headline">¶</a></h1>
<p><img alt="https://github.com/mpicbg-csbd/stardist/raw/master/images/stardist_overview.png" src="https://github.com/mpicbg-csbd/stardist/raw/master/images/stardist_overview.png" /></p>
<p>This repository contains the implementation of star-convex object detection for 2D and 3D images, as described in the papers:</p>
<img src="https://github.com/mpicbg-csbd/stardist/raw/master/images/stardist_logo.jpg" title="siân is the king of the universe" width="25%" align="right"><ul class="simple">
<li><p>Uwe Schmidt, Martin Weigert, Coleman Broaddus, and Gene Myers.<br /><a class="reference external" href="https://arxiv.org/abs/1806.03535"><em>Cell Detection with Star-convex Polygons</em></a>.<br />International Conference on Medical Image Computing and Computer-Assisted Intervention (MICCAI), Granada, Spain, September 2018.</p></li>
<li><p>Martin Weigert, Uwe Schmidt, Robert Haase, Ko Sugawara, and Gene Myers.<br /><a class="reference external" href="http://openaccess.thecvf.com/content_WACV_2020/papers/Weigert_Star-convex_Polyhedra_for_3D_Object_Detection_and_Segmentation_in_Microscopy_WACV_2020_paper.pdf"><em>Star-convex Polyhedra for 3D Object Detection and Segmentation in Microscopy</em></a>.<br />The IEEE Winter Conference on Applications of Computer Vision (WACV), Snowmass Village, Colorado, March 2020</p></li>
</ul>
<p>Please <a class="reference external" href="#how-to-cite">cite the paper(s)</a> if you are using this code in your research.</p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The following figure illustrates the general approach for 2D images. The training data consists of corresponding pairs of input (i.e. raw) images and fully annotated label images (i.e. every pixel is labeled with a unique object id or 0 for background).
A model is trained to densely predict the distances (r) to the object boundary along a fixed set of rays and object probabilities (d), which together produce an overcomplete set of candidate polygons for a given input image. The final result is obtained via non-maximum supression (NMS) of these candidates.</p>
<p><img alt="https://github.com/mpicbg-csbd/stardist/raw/master/images/overview_2d.png" src="https://github.com/mpicbg-csbd/stardist/raw/master/images/overview_2d.png" /></p>
<p>The approach for 3D volumes is similar to the one described for 2D, using pairs of input and fully annotated label volumes as training data.</p>
<p><img alt="https://github.com/mpicbg-csbd/stardist/raw/master/images/overview_3d.png" src="https://github.com/mpicbg-csbd/stardist/raw/master/images/overview_3d.png" /></p>
</div>
<div class="section" id="webinar-tutorial">
<h2>Webinar/Tutorial<a class="headerlink" href="#webinar-tutorial" title="Permalink to this headline">¶</a></h2>
<p>If you want to know more about the concepts and practical applications of StarDist, please have a look at the following webinar that was given at NEUBIAS Academy &#64;Home 2020:</p>
<p><a class="reference external" href="http://www.youtube.com/watch?v=Amn_eHRGX5M"><img alt="webinar video" src="http://img.youtube.com/vi/Amn_eHRGX5M/0.jpg" /></a></p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>This package requires Python 3.5 (or newer).</p>
<p>Please first <a class="reference external" href="https://www.tensorflow.org/install">install TensorFlow 1.x</a>
by following the official instructions. (<strong>Do not choose TensorFlow 2.x</strong>)
For <a class="reference external" href="https://www.tensorflow.org/install/gpu">GPU support</a>, it is very
important to install the specific versions of CUDA and cuDNN that are
compatible with the respective version of TensorFlow.</p>
<p><em>StarDist</em> can then be installed with <code class="docutils literal notranslate"><span class="pre">pip</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">stardist</span>
</pre></div>
</div>
<div class="section" id="notes">
<h3>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Depending on your Python installation, you may need to use <code class="docutils literal notranslate"><span class="pre">pip3</span></code> instead of <code class="docutils literal notranslate"><span class="pre">pip</span></code>.</p></li>
<li><p>Since this package relies on a C++ extension, you could run into compilation problems (see <a class="reference external" href="#troubleshooting">Troubleshooting</a> below). We currently do not provide pre-compiled binaries.</p></li>
<li><p>StarDist uses the deep learning library <a class="reference external" href="https://keras.io">Keras</a>, which requires a suitable <a class="reference external" href="https://keras.io/backend/#keras-backends">backend</a> (we currently only support <a class="reference external" href="http://www.tensorflow.org/">TensorFlow</a>).</p></li>
<li><p><em>(Optional)</em> You need to install <a class="reference external" href="https://github.com/maweigert/gputools">gputools</a> if you want to use OpenCL-based computations on the GPU to speed up training.</p></li>
<li><p><em>(Optional)</em> You might experience improved performance during training if you additionally install the <a class="reference external" href="https://github.com/seung-lab/euclidean-distance-transform-3d">Multi-Label Anisotropic 3D Euclidean Distance Transform (MLAEDT-3D)</a>.</p></li>
</ul>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>We provide example workflows for 2D and 3D via Jupyter <a class="reference external" href="https://github.com/mpicbg-csbd/stardist/tree/master/examples">notebooks</a> that illustrate how this package can be used.</p>
<p><img alt="https://github.com/mpicbg-csbd/stardist/raw/master/images/example_steps.png" src="https://github.com/mpicbg-csbd/stardist/raw/master/images/example_steps.png" /></p>
<div class="section" id="pretrained-models-for-2d">
<h3>Pretrained Models for 2D<a class="headerlink" href="#pretrained-models-for-2d" title="Permalink to this headline">¶</a></h3>
<p>Currently we provide some pretrained models in 2D that might already be suitable for your images:</p>
<p>| key | Modality (Staining) | Image format | Example Image    | Description  |
| :– | :-: | :-:| :-:| :– |
| <code class="docutils literal notranslate"><span class="pre">2D_versatile_fluo</span></code> <code class="docutils literal notranslate"><span class="pre">2D_paper_dsb2018</span></code>| Fluorescence (nuclear marker) | 2D single channel| <img src="https://github.com/mpicbg-csbd/stardist/raw/master/images/example_fluo.jpg" title="example image fluo" width="120px" align="center">       | <em>Versatile (fluorescent nuclei)</em> and <em>DSB 2018 (from StarDist 2D paper)</em> that were both trained on a subset of the <a class="reference external" href="https://data.broadinstitute.org/bbbc/BBBC038/"> DSB 2018 nuclei segmentation challenge dataset</a>. |
|<code class="docutils literal notranslate"><span class="pre">2D_versatile_he</span></code> | Brightfield (H&amp;E) | 2D RGB  | <img src="https://github.com/mpicbg-csbd/stardist/raw/master/images/example_histo.jpg" title="example image histo" width="120px" align="center">       | <em>Versatile (H&amp;E nuclei)</em> that was trained on images from the <a class="reference external" href="https://monuseg.grand-challenge.org/Data/">MoNuSeg 2018 training data</a> and the <a class="reference external" href="http://cancergenome.nih.gov/">TCGA archive</a>. |</p>
<p>You can access these pretrained models from <code class="docutils literal notranslate"><span class="pre">stardist.models.StarDist2D</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">from</span> <span class="nn">stardist.models</span> <span class="kn">import</span> <span class="n">StarDist2D</span> 

<span class="c1"># prints a list of available models </span>
<span class="n">StarDist2D</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">()</span> 

<span class="c1"># creates a pretrained model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">StarDist2D</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s1">&#39;2D_versatile_fluo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="annotating-images">
<h3>Annotating Images<a class="headerlink" href="#annotating-images" title="Permalink to this headline">¶</a></h3>
<p>To train a <em>StarDist</em> model you will need some ground-truth annotations: for every raw training image there has to be a corresponding label image where all pixels of a cell region are labeled with a distinct integer (and background pixels are labeled with 0). To create such label masks, one can use e.g. the Imagej/Fiji plugin <a class="reference external" href="https://imagej.net/Labkit">Labkit</a>:</p>
<ol class="simple">
<li><p>Install <a class="reference external" href="https://fiji.sc">Fiji</a> and the <a class="reference external" href="https://imagej.net/Labkit">Labkit</a> plugin</p></li>
<li><p>Open the (2D or 3D) image and start Labkit via <code class="docutils literal notranslate"><span class="pre">Plugins</span> <span class="pre">&gt;</span> <span class="pre">Segmentation</span> <span class="pre">&gt;</span> <span class="pre">Labkit</span></code></p></li>
<li><p>Sucessively add a new label and annotate a single cell instance with the brush tool (always check the <code class="docutils literal notranslate"><span class="pre">override</span></code> option) until <em>all</em> cells are labeled</p></li>
<li><p>Export the label image via <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">Labeling...</span></code> and <code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">format</span> <span class="pre">&gt;</span> <span class="pre">TIF</span> <span class="pre">Image</span></code></p></li>
</ol>
<p><img alt="https://github.com/mpicbg-csbd/stardist/raw/master/images/labkit_2d_labkit.png" src="https://github.com/mpicbg-csbd/stardist/raw/master/images/labkit_2d_labkit.png" /></p>
<p>Additional tips:</p>
<ul class="simple">
<li><p>The Labkit viewer uses <a class="reference external" href="https://imagej.net/BigDataViewer">BigDataViewer</a> and its keybindings (e.g. <kbd>s</kbd> for contrast options, <kbd>CTRL</kbd>+<kbd>Shift</kbd>+<kbd>mouse-wheel</kbd> for zoom-in/out etc.)</p></li>
<li><p>For 3D images (XYZ) it is best to first convert it to a (XYT) timeseries (via <code class="docutils literal notranslate"><span class="pre">Re-Order</span> <span class="pre">Hyperstack</span></code> and swapping <code class="docutils literal notranslate"><span class="pre">z</span></code> and <code class="docutils literal notranslate"><span class="pre">t</span></code>) and then use <kbd>[</kbd> and <kbd>]</kbd> in Labkit to walk through the slices.</p></li>
</ul>
</div>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<p>Installation requires Python 3.5 (or newer) and a working C++ compiler. We have only tested <a class="reference external" href="http://gcc.gnu.org">GCC</a> (macOS, Linux), <a class="reference external" href="https://clang.llvm.org">Clang</a> (macOS), and <a class="reference external" href="https://visualstudio.microsoft.com">Visual Studio</a> (Windows 10). Please <a class="reference external" href="https://github.com/mpicbg-csbd/stardist/issues">open an issue</a> if you have problems that are not resolved by the information below.</p>
<p>If available, the C++ code will make use of <a class="reference external" href="https://en.wikipedia.org/wiki/OpenMP">OpenMP</a> to exploit multiple CPU cores for substantially reduced runtime on modern CPUs. This can be important to prevent slow model training.</p>
<div class="section" id="macos">
<h3>macOS<a class="headerlink" href="#macos" title="Permalink to this headline">¶</a></h3>
<p>The default Apple C/C++ compiler (<code class="docutils literal notranslate"><span class="pre">clang</span></code>) does not come with OpenMP support and the package build will likely fail.
To properly build <code class="docutils literal notranslate"><span class="pre">stardist</span></code> you need to install a OpenMP-enabled GCC compiler, e.g. via <a class="reference external" href="https://brew.sh">Homebrew</a> with <code class="docutils literal notranslate"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">gcc</span></code> (which will currently install <code class="docutils literal notranslate"><span class="pre">gcc-9</span></code>/<code class="docutils literal notranslate"><span class="pre">g++-9</span></code>). After that, you can build the package like this (adjust compiler names/paths as necessary):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CC</span><span class="o">=</span><span class="n">gcc</span><span class="o">-</span><span class="mi">9</span> <span class="n">CXX</span><span class="o">=</span><span class="n">g</span><span class="o">++-</span><span class="mi">9</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">stardist</span>
</pre></div>
</div>
<p>If you use <code class="docutils literal notranslate"><span class="pre">conda</span></code> on macOS and after <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">stardist</span></code> see errors similar to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Symbol</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span> <span class="n">_GOMP_loop_nonmonotonic_dynamic_next</span>
</pre></div>
</div>
<p>please see <a class="reference external" href="https://github.com/mpicbg-csbd/stardist/issues/19#issuecomment-535610758">this issue</a> for a temporay workaround.</p>
</div>
<div class="section" id="windows">
<h3>Windows<a class="headerlink" href="#windows" title="Permalink to this headline">¶</a></h3>
<p>Please install the <a class="reference external" href="https://www.visualstudio.com/downloads/#build-tools-for-visual-studio-2019">Build Tools for Visual Studio 2019</a> from Microsoft to compile extensions for Python 3.5 and newer (see <a class="reference external" href="https://wiki.python.org/moin/WindowsCompilers">this</a> for further information). During installation, make sure to select the <em>C++ build tools</em>. Note that the compiler comes with OpenMP support.</p>
</div>
</div>
<div class="section" id="imagej-fiji-plugin">
<h2>ImageJ/Fiji Plugin<a class="headerlink" href="#imagej-fiji-plugin" title="Permalink to this headline">¶</a></h2>
<p>We currently provide a ImageJ/Fiji plugin that can be used to run pretrained StarDist models on 2D or 2D+time images. Installation and usage instructions can be found at the <a class="reference external" href="https://imagej.net/StarDist">plugin page</a>.</p>
</div>
<div class="section" id="how-to-cite">
<h2>How to cite<a class="headerlink" href="#how-to-cite" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@inproceedings</span><span class="p">{</span><span class="n">schmidt2018</span><span class="p">,</span>
  <span class="n">author</span>    <span class="o">=</span> <span class="p">{</span><span class="n">Uwe</span> <span class="n">Schmidt</span> <span class="ow">and</span> <span class="n">Martin</span> <span class="n">Weigert</span> <span class="ow">and</span> <span class="n">Coleman</span> <span class="n">Broaddus</span> <span class="ow">and</span> <span class="n">Gene</span> <span class="n">Myers</span><span class="p">},</span>
  <span class="n">title</span>     <span class="o">=</span> <span class="p">{</span><span class="n">Cell</span> <span class="n">Detection</span> <span class="k">with</span> <span class="n">Star</span><span class="o">-</span><span class="n">Convex</span> <span class="n">Polygons</span><span class="p">},</span>
  <span class="n">booktitle</span> <span class="o">=</span> <span class="p">{</span><span class="n">Medical</span> <span class="n">Image</span> <span class="n">Computing</span> <span class="ow">and</span> <span class="n">Computer</span> <span class="n">Assisted</span> <span class="n">Intervention</span> <span class="o">-</span> <span class="p">{</span><span class="n">MICCAI</span><span class="p">}</span> 
  <span class="mi">2018</span> <span class="o">-</span> <span class="mi">21</span><span class="n">st</span> <span class="n">International</span> <span class="n">Conference</span><span class="p">,</span> <span class="n">Granada</span><span class="p">,</span> <span class="n">Spain</span><span class="p">,</span> <span class="n">September</span> <span class="mi">16</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">2018</span><span class="p">,</span> <span class="n">Proceedings</span><span class="p">,</span> <span class="n">Part</span> <span class="p">{</span><span class="n">II</span><span class="p">}},</span>
  <span class="n">pages</span>     <span class="o">=</span> <span class="p">{</span><span class="mi">265</span><span class="o">--</span><span class="mi">273</span><span class="p">},</span>
  <span class="n">year</span>      <span class="o">=</span> <span class="p">{</span><span class="mi">2018</span><span class="p">},</span>
  <span class="n">doi</span>       <span class="o">=</span> <span class="p">{</span><span class="mf">10.1007</span><span class="o">/</span><span class="mi">978</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="mi">030</span><span class="o">-</span><span class="mi">00934</span><span class="o">-</span><span class="mi">2</span><span class="n">_30</span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@inproceedings</span><span class="p">{</span><span class="n">weigert2019</span><span class="p">,</span>
  <span class="n">author</span>    <span class="o">=</span> <span class="p">{</span><span class="n">Martin</span> <span class="n">Weigert</span> <span class="ow">and</span> <span class="n">Uwe</span> <span class="n">Schmidt</span> <span class="ow">and</span> <span class="n">Robert</span> <span class="n">Haase</span> <span class="ow">and</span> <span class="n">Ko</span> <span class="n">Sugawara</span> <span class="ow">and</span> <span class="n">Gene</span> <span class="n">Myers</span><span class="p">},</span>
  <span class="n">title</span>     <span class="o">=</span> <span class="p">{</span><span class="n">Star</span><span class="o">-</span><span class="n">convex</span> <span class="n">Polyhedra</span> <span class="k">for</span> <span class="mi">3</span><span class="n">D</span> <span class="n">Object</span> <span class="n">Detection</span> <span class="ow">and</span> <span class="n">Segmentation</span> <span class="ow">in</span> <span class="n">Microscopy</span><span class="p">},</span>
  <span class="n">booktitle</span> <span class="o">=</span> <span class="p">{</span><span class="n">The</span> <span class="n">IEEE</span> <span class="n">Winter</span> <span class="n">Conference</span> <span class="n">on</span> <span class="n">Applications</span> <span class="n">of</span> <span class="n">Computer</span> <span class="n">Vision</span> <span class="p">(</span><span class="n">WACV</span><span class="p">)},</span>
  <span class="n">month</span>     <span class="o">=</span> <span class="p">{</span><span class="n">March</span><span class="p">},</span>
  <span class="n">year</span>      <span class="o">=</span> <span class="p">{</span><span class="mi">2020</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, StarDist docs authors.
      <span class="lastupdated">
        Last updated on May 28, 2020.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>